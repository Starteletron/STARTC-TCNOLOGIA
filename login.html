<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Login — StarC Tecnologias</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <style>
    :root{
      --bg:#f6faf8; --surface:#ffffff; --text:#0f172a; --muted:#475569; --line:#e2e8f0;
      --brand:#10b981; --brand-2:#059669; --danger:#ef4444; --ok:#16a34a; --ink:#0b1220;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--text); background: radial-gradient(1200px 600px at 80% -10%, #d8ffe7 0%, #ffffff 60%) no-repeat, var(--bg);
    }
    .wrap{min-height:100%;display:grid;place-items:center;padding:24px}
    .card{
      width:100%; max-width:980px; display:grid; grid-template-columns:1fr 1fr; gap:18px;
      background:var(--surface); border:1px solid var(--line); border-radius:18px; padding:22px;
      box-shadow:0 20px 60px rgba(15,23,42,.08);
    }
    .left{padding:10px 4px 10px 10px}
    .brand{display:flex;align-items:center;gap:10px;margin-bottom:12px}
    .brand img{width:40px;height:40px;border-radius:10px;object-fit:contain;background:#fff}
    .brand b{font-size:1.1rem}
    h1{font-size:1.9rem;line-height:1.2;margin:4px 0 6px}
    p.lead{color:var(--muted);margin-bottom:14px}
    .feature{display:flex;gap:10px;align-items:flex-start;color:var(--muted);margin:6px 0}
    .feature svg{min-width:18px;margin-top:2px}
    .cta{display:flex;gap:10px;align-items:center;margin-top:10px}
    .badge{font-size:.8rem;font-weight:800;color:#065f46;background:#d1fae5;border:1px solid #a7f3d0;border-radius:999px;padding:6px 10px}
    .right{border-left:1px dashed var(--line);padding-left:18px}
    .form h2{font-size:1.2rem;margin-bottom:10px}
    label{font-weight:700;font-size:.92rem}
    input{width:100%;margin-top:6px;margin-bottom:10px;padding:12px;border:1px solid var(--line);border-radius:10px;background:#f8fafc}
    button{border:none;border-radius:12px;padding:12px 16px;font-weight:800;cursor:pointer}
    .btn{background:var(--brand);color:#052e26}
    .btn:hover{background:var(--brand-2)}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .muted{color:var(--muted);font-size:.9rem}
    .error{margin-top:8px;color:#fff;background:var(--danger);padding:10px;border-radius:10px;display:none}
    .ok{margin-top:8px;color:#052e26;background:#bbf7d0;padding:10px;border-radius:10px;display:none}
    .sep{display:flex;align-items:center;gap:10px;margin:14px 0}
    .sep span{color:#64748b;font-weight:800;font-size:.8rem;letter-spacing:.12em;text-transform:uppercase}
    .sep:before,.sep:after{content:"";flex:1;border-top:1px solid var(--line)}
    .gbtn{display:none;margin-top:4px}
    .foot{margin-top:12px;color:#64748b;font-size:.85rem}
    .legal{margin-top:8px;color:#94a3b8;font-size:.8rem}
    @media (max-width:900px){.card{grid-template-columns:1fr}}
  </style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <!-- Lado esquerdo: branding / valor -->
    <section class="left">
      <div class="brand">
        <img src="./assents/logo.png" alt="StarC">
        <b>StarC Tecnologias</b>
      </div>
      <h1>Acesso seguro para assinantes</h1>
      <p class="lead">Entre para usar as ferramentas, NEYBOT e fluxos de automação. Validação feita via Google Sheets.</p>

      <div class="feature">
        <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor"><path d="M9 12l2 2 4-4 1.5 1.5L11 16l-3.5-3.5L9 12zm3-9C6.48 3 2 7.48 2 13s4.48 10 10 10 10-4.48 10-10S17.52 3 12 3z"/></svg>
        <div>Somente e-mails **Ativos** na planilha acessam.</div>
      </div>
      <div class="feature">
        <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor"><path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 2.18L19 6v5c0 4.66-3.11 9.2-7 10.43C8.11 20.2 5 15.66 5 11V6l7-2.82zM7 9h10v2H7V9z"/></svg>
        <div>Dados sensíveis não saem do seu navegador nas ferramentas.</div>
      </div>
      <div class="cta">
        <span class="badge">Acesso por e-mail/senha e Google</span>
      </div>
    </section>

    <!-- Lado direito: login -->
    <section class="right">
      <form class="form" id="formLogin" onsubmit="return false;">
        <h2>Entrar</h2>
        <div class="row">
          <div>
            <label for="lemail">E-mail</label>
            <input id="lemail" type="email" placeholder="voce@empresa.com" autocomplete="username" />
          </div>
          <div>
            <label for="lsenha">Senha</label>
            <input id="lsenha" type="password" placeholder="********" autocomplete="current-password" />
          </div>
        </div>
        <button class="btn" id="btnLogin">Entrar</button>
        <div id="msgError" class="error"></div>
        <div id="msgOk" class="ok"></div>

        <div class="sep"><span>ou</span></div>

        <!-- Botão Google (opcional) -->
        <div id="gWrap">
          <div id="g_id_onload"
               data-client_id=""
               data-context="signin"
               data-callback="onGoogleCredential"
               data-auto_select="false"
               data-itp_support="true">
          </div>
          <div class="g_id_signin gbtn" data-type="standard" data-size="large" data-theme="outline" data-text="signin_with" data-shape="rect" data-logo_alignment="left"></div>
          <div class="legal">Para usar o Google, configure o <b>CLIENT_ID</b> do seu projeto. Se não configurar, este botão não aparece.</div>
        </div>

        <div class="foot">
          Precisa de acesso? Fale com o administrador. | <a href="contato.html" style="color:#0f766e;text-decoration:none;font-weight:700">Contato</a>
        </div>
      </form>
    </section>
  </div>
</div>

<script>
  // ======= CONFIGURAÇÕES =======
  // URL googleusercontent (funciona com CORS) — já com a sua:
  const GAS_URL = 'https://script.googleusercontent.com/macros/echo?user_content_key=AehSKLhFOy5iHe7qI1Sjc9tSalZSmjUfPJ938izzhpoPFXF-mGnQZcSd1UVuRbc-3UCF2jtfGYJBb8tBejq_OkyPFDT5XyCW_LD_UFNbn36J3cX9verqgVs29VGG3vrz16TVnSlJL0Q1OeD8hJkBktL_1kKq-fmuM93E-HeLFBn2vgPJesoUhAReU1PJqhJfFyj76k-whvBsKzhv1oZGxnKCXDmJe5h3t87WNtoWM3oG7nokXQrRb24kNSZAk5QfIT3x4nk6g3FvdXmz1gPsu9W-bNIUNknllA&lib=MZLXwSrR-lu0DZcmckpykCDr5UI-PC8DI';
  const REDIRECT_AFTER = 'ferramentas.html';

  // Se quiser Google SSO: cole seu Client ID abaixo. Se deixar vazio (""), esconde o botão.
  const GOOGLE_CLIENT_ID = "7204769398-sg77au22ks3doi4igndhiejhrg68sfdr.apps.googleusercontent.com"; // ex: "1234567890-xxxxxxxxxxxxxxxxxxxxxxxxxxxx.apps.googleusercontent.com"
  // =============================

  // Se já estiver logado, vai direto
  (function autoForward(){
    try{
      const u = JSON.parse(localStorage.getItem('stc_user') || "null");
      if(u && (u.email || u.nome)){ window.location.href = REDIRECT_AFTER; }
    }catch(_){}
  })();

  const $ = (sel)=> document.querySelector(sel);
  const msgE = $('#msgError');
  const msgO = $('#msgOk');

  function showError(txt){
    msgO.style.display='none';
    msgE.textContent = txt;
    msgE.style.display='block';
  }
  function showOk(txt){
    msgE.style.display='none';
    msgO.textContent = txt;
    msgO.style.display='block';
  }

  // Login por e-mail/senha
  $('#btnLogin').addEventListener('click', async ()=>{
    const email = $('#lemail').value.trim();
    const senha = $('#lsenha').value;
    if(!email || !senha){ showError('Informe e-mail e senha.'); return; }
    showOk('Validando...');
    try{
      const r = await fetch(GAS_URL, {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({tipo:'login_senha', email, senha})
      });
      const data = await r.json().catch(()=> ({}));
      if(data.status === 'ok'){
        localStorage.setItem('stc_user', JSON.stringify(data.user));
        showOk('Acesso liberado. Redirecionando...');
        setTimeout(()=> window.location.href = REDIRECT_AFTER, 400);
      }else{
        showError(data.msg || 'Login inválido.');
      }
    }catch(e){
      showError('Erro ao conectar. Verifique sua Internet ou tente novamente.');
    }
  });

  // Google SSO — só mostra se tiver client id configurado
  (function setupGoogle(){
    const wrap = document.getElementById('gWrap');
    const onloadDiv = document.getElementById('g_id_onload');
    const btnDiv = document.querySelector('.gbtn');
    if(!GOOGLE_CLIENT_ID){
      wrap.style.display='none';
      return;
    }
    onloadDiv.setAttribute('data-client_id', GOOGLE_CLIENT_ID);
    btnDiv.style.display='block';
  })();

  // Decodifica JWT do Google
  function parseJwt(token){
    const base64Url = token.split('.')[1];
    const base64 = decodeURIComponent(atob(base64Url).split('').map(c=>'%' + ('00'+c.charCodeAt(0).toString(16)).slice(-2)).join(''));
    return JSON.parse(base64);
  }

  // Callback do Google SSO
  async function onGoogleCredential(resp){
    try{
      const jwt = parseJwt(resp.credential);
      showOk('Validando Google...');
      const r = await fetch(GAS_URL, {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({tipo:'login_google', email: jwt.email, nome: jwt.name})
      });
      const data = await r.json().catch(()=> ({}));
      if(data.status === 'ok'){
        localStorage.setItem('stc_user', JSON.stringify(data.user));
        showOk('Acesso liberado. Redirecionando...');
        setTimeout(()=> window.location.href = REDIRECT_AFTER, 400);
      }else{
        showError(data.msg || 'Este e-mail não está autorizado.');
      }
    }catch(e){
      showError('Falha ao validar o Google Sign-In.');
    }
  }
  window.onGoogleCredential = onGoogleCredential;
</script>
</body>
</html>
